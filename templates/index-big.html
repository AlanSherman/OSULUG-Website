{% extends "base.html" %}

{# Set defaults #}

{% set min_height = 150 %}
{% set char_limit = 500 %}
{% set collection = page.subpages %}

{% if page.index %}
    {% if page.index.height %}
        {% set min_height = page.index.height %}
    {% endif %}
    {% if page.index.char_limit %}
        {% set char_limit = page.index.char_limit %}
    {% endif %}
    {% if page.index.char_limit %}
        {% set char_limit = page.index.char_limit %}
    {% endif %}

    {% if page.index.sort_key %}
        {% if page.index.reverse %}
            {% set collection = page.subpages|
                sort(attribute=page.index.sort_key) %}
        {% else %}
            {% set collection = page.subpages|
                sort(attribute=page.index.sort_key, reverse=True) %}
        {% endif %}
    {% endif %}
{% endif %}

{# Render list #}

{% block content %}
<h1>{{ page.title }}</h1>
{{ page.content }}

<div class="index-big">
    {% for subpage in collection %}
        <div class="index-big-item">
            <div class="headinggroup">
                <h2><a href="{{subpage.url}}">{{subpage.title}}</a></h2>
                <span class="metadata">
                    {% if subpage.authors %}
                        by {% for author in subpage.authors %}
                            {% if loop.last and not loop.first %}and {% endif %}
                            {{ author.name }}{% if not loop.last %}, {% endif %}
                        {% endfor %}
                    {% endif %}
                    {% if subpage.datetime %}
                        on {{ subpage.datetime.strftime("%A %B %d, %Y at %I:%M %p ") }}
                    {% endif %}
                </span>
            </div>

            {% if subpage.image %}
                <div class="blog-index-image">
                    <img src="{{subpage.image.url}}"/>
                </div>
            {% endif %}

            <div style="min-height: {{min_height}}px;">
                <span class="blog-index-post">
                    {{subpage.content|truncate(length=char_limit, end="<a href="+subpage.url+">...more</a>")}}
                </span>
            </div>
        </div>

        {% if not loop.last %}
            <hr/>
        {% endif %}
    {% endfor %}
</div>
{% endblock %}
